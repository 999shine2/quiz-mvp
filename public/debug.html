<!DOCTYPE html>
<html>

<head>
    <title>Quiz Debug Inspector</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }

        pre {
            background: #000;
            padding: 10px;
            overflow: auto;
            max-height: 400px;
        }

        button {
            padding: 10px 20px;
            margin: 10px 0;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>üîç Quiz Data Inspector</h1>
    <button onclick="inspectLibrary()">Check Library Data</button>
    <button onclick="inspectBuffer()">Check Endless Buffer</button>
    <button onclick="inspectLocalStorage()">Check All LocalStorage</button>

    <h2>Results:</h2>
    <pre id="output">Click a button above to inspect...</pre>

    <script>
        function inspectLibrary() {
            fetch('/api/library', {
                headers: { 'x-user-id': localStorage.getItem('user_name') || 'guest' }
            })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('output').textContent =
                        `Library Files: ${data.length}\n\n` +
                        `First File:\n${JSON.stringify(data[0], null, 2)}\n\n` +
                        `First Question from First File:\n${JSON.stringify(data[0]?.questions?.[0], null, 2)}`;
                })
                .catch(e => {
                    document.getElementById('output').textContent = 'ERROR: ' + e.message;
                });
        }

        function inspectBuffer() {
            document.getElementById('output').textContent =
                `Endless Buffer Length: ${window.endlessBuffer?.length || 0}\n\n` +
                `First Buffered Item:\n${JSON.stringify(window.endlessBuffer?.[0], null, 2)}`;
        }

        function inspectLocalStorage() {
            let out = 'LocalStorage Contents:\n\n';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const val = localStorage.getItem(key);
                out += `${key}: ${val.substring(0, 200)}${val.length > 200 ? '...' : ''}\n\n`;
            }
            document.getElementById('output').textContent = out;
        }
    </script>
</body>

</html>